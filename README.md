# PyCli

PyCli is a domain specific language (DSL) embedded in Python for climate
modeling. Users can specify the amount of CO2 in the atmosphere in Python, and 
the model computes temperatures across the planet. By tweaking the levels of greenhouse
gases in the atmosphere, users can see how the climate changes. The final output
of the simulation a temperature map of the planet generated by the visualization
suite.

PyCli is designed to be an educational tool for understanding global warming
and climate change modeling. PyCli uses a very simplified model of the climate to do 
calculations and ignores factors such as particulate matter, cloud cover,
and ocean currents. This project is not meant to compete with the climate
models designed by national institutes. Rather, it is purely an educational
tool designed for people interested in climate change and scientific computing.

## Supported Modeling Features
PyCli uses a discretized grid to represent the earth and to simulate
temperatures. Currently, the model allows users to specify:

1. The surface of the planet (land, sea, or ice)
2. The model resolution, defined by the size of the grid
3. The composition of the atmosphere at each simulation step. The CO2 level is
currently the main driver of temperature changes between steps.

## Environment

PyCli was has the following system requirements and dependencies:


Python:
```
python3
matplotlib
numpy
mpl_toolkits
argparse
```

C++:
```
C++14
OpenMP
```

OS and other:
```
macOS or Ubuntu
git
```

PyCli was tested on machines running macOS 10.15 Catalina and Ubuntu 14 but
should run on similar operating systems. PyCli is not compatible with
Windows, and there are no plans to build a Windows port.

## Installation

To install PyCli, first clone the repository:

```
git clone https://github.com/timsliu/pycli.git
```

Next, navigate to the python source file and install the PyCli python library:

```
cd pycli/pysrc
pip3 install -e .
```
And that's it! If you're missing some of the dependencies, follow the
instructions below. Please note that `pycli` is also the name of a Python
Command Line Interface (CLI) library and that installing PyCli may cause the 
Python CLI to be uninstalled. Future versions of PyCli will resolve this
naming issue.

### Installing dependencies
If you don't have some of the Python libraries, use pip to install them:

```
pip3 install matplotlib
pip3 install numpy
pip3 install mpl_toolkits
pip3 install argparse

```

To install OpenMP on macOS, use Homebrew:

```
brew install libomp
```

To install on Ubuntu:

```
sudo apt-get install libomp-dev
```


## Running your first model

First, make sure you've completed all the steps in the Installation section.
Climate models written in PyCli should be saved in the `pycli/models` subdirectory.
The PyCli repo includes several example climate models. The 
`earth.py` model simulates the Earth's climate across five timesteps
with varying levels of CO2.

To run a model, use the following command while in the `<models>` directory:

```
python3 run-pycli.py <model_name>
```

For the `earth_big` prewritten model, the command is:

```
python3 run-pycli.py earth
```

Note that the model name should not have `.py` at the end - only include
The name of the model. The `run-pycli.py` script will run the PyCli
model interpreter, the climate simulation backend, and the visualization
suite. The output should look like:


![Alt text](images/run-pycli_out.png?raw=true "Output from running run-pycli.py")


The script will create a directory with the name of the model in
the `<models>` folder and place a `surface.txt` and `atmosphere.txt`
file in the directory. These files describe the surface of the planet and
the atmosphere at each simulation step. After the simulation is run, a map
of the final temperatures will be placed in models folder.

![Alt text](images/earth_big.png?raw=true "Earth Big temperature map")

## Folder Organization
This section briefly describes the contents of each of the subfolders in the
PyCli repo. Each section has a `README.md` with more details about the subfolders
function.

### src
The `src` directory contains the C++ backend for running the climate model.
This folder also contains the `Makefile` for compiling the model. Users wishing
to modify the climate model should make changes in this directory.

### models
This directory contains PyCli models. All PyCli models should be written and
saved in this directory. Each time a PyCli model is run, a new subfolder will
be generated holding the atmosphere and surface configuration files. The final
temperature map will also be dumped into this directory.

This directory also holds the `run-pycli.py` script. This script is run to
invoke the entire PyCli stack. The script will run the PyCli front end to
generated configuration files, launch the C++ backend, and finally use the
visualization suite to create graphs and maps.

### bin
The `bin` directory contains compiled binary files.

### pysrc
This directory contains the PyCli library for the PyCli front end. The front
end is implemented as a series of method calls for users to create a new
model, set the surface, and specify the atmosphere at each step. The Python
front end is also responsible for generating the model configuration files used
by the C++ climate model.

Users wishing to learn more about writing models in PyCli should read the
`README` in this folder.

### tex
This directory contains typeset documents describing how the C++ climate
model backend works. Users interested in the science and mathematics behind
the model should read this document.


### pyvisual
This directory contains the installation of the `basemap` library used for
generating temperature maps. This folder also has the visualization suite
responsible for parsing temperature files and generating temperature maps.

## Planned features

### Python Frontend

* Improved random surface generation using random "islands" that grow in 
each direction based on some probability (v 0.2)
* Use Python operator overloading to allow setting atmospheric gas
concentrations without calling methods (v 0.2)
* Conditional statements based on temperature (v 0.3)

### Backend climate model
* Add accelerated convolution and average temp calculation so accelerated
model can be used (v 0.2)
* Add tilt to the planet (v 0.4)
* Make temperature at each timestep influenced by previous timestep - currently
each timestep is independent (v 0.2)
* Change surfaces so that ice can melt and water can freeze depending on temperature (v 0.3)
* Spawn additional threads to output temperature files in parallel with calculations (v 0.2)
* Optionally output intermediate temperature files (v 0.2)

### Visualization suite
* Stitch temperature files into a gif (v 0.3)

### Additional features

## Contributors and Contact
PyCli is an open source project created by Kalhan Koul, Timothy Liu, and
Jack Melchert at Stanford. This project originated from a [CS343D: Domain Specific
Programming Models and Compilers](https://cs343d.github.io/)  course assignment
and is currently maintained and updated by Timothy Liu.
